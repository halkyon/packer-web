{
	"description": "Build and provision a web machine capable of running a LAMP stack application",
	"variables": {
		"username": "vagrant",
		"password": "vagrant"
	},
	"builders": [
		{
			"name": "virtualbox-web-squeeze-php53",
			"type": "virtualbox-iso",
			"guest_os_type": "Debian_64",
			"vm_name": "web-squeeze-php53",
			"iso_url": "http://cdimage.debian.org/mirror/cdimage/archive/6.0.10/amd64/iso-cd/debian-6.0.10-amd64-netinst.iso",
			"iso_checksum": "7f82d341561035f65933da43f94d5b52",
			"iso_checksum_type": "md5",
			"output_directory": "./builds/virtualbox-web-squeeze-php53/virtualbox",
			"ssh_username": "{{user `username`}}",
			"ssh_password": "{{user `password`}}",
			"ssh_wait_timeout": "30m",
			"http_directory": "./scripts",
			"boot_wait": "5s",
			"boot_command": [
				"<esc><wait>",
				"install auto=true ",
				"preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg ",
				"keymap=us ",
				"netcfg/get_domain=unassigned-domain ",
				"hostname={{ .Name }} ",
				"passwd/username={{user `username`}} ",
				"passwd/user-fullname={{user `username`}} ",
				"passwd/user-password-again={{user `password`}} ",
				"passwd/user-password={{user `password`}} ",
				"-- <enter>"
			],
			"shutdown_command": "echo '{{user `password`}}' | sudo -S shutdown -P -h now"
		},
		{
			"name": "virtualbox-web-wheezy-php54",
			"type": "virtualbox-iso",
			"guest_os_type": "Debian_64",
			"vm_name": "web-wheezy-php54",
			"iso_url": "http://cdimage.debian.org/mirror/cdimage/archive/7.8.0/amd64/iso-cd/debian-7.8.0-amd64-netinst.iso",
			"iso_checksum": "a91fba5001cf0fbccb44a7ae38c63b6e",
			"iso_checksum_type": "md5",
			"output_directory": "./builds/virtualbox-web-wheezy-php54/virtualbox",
			"ssh_username": "{{user `username`}}",
			"ssh_password": "{{user `password`}}",
			"ssh_wait_timeout": "30m",
			"http_directory": "./scripts",
			"boot_wait": "5s",
			"boot_command": [
				"<esc><wait>",
				"install auto=true ",
				"preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg ",
				"keymap=us ",
				"netcfg/get_domain=unassigned-domain ",
				"hostname={{ .Name }} ",
				"passwd/username={{user `username`}} ",
				"passwd/user-fullname={{user `username`}} ",
				"passwd/user-password-again={{user `password`}} ",
				"passwd/user-password={{user `password`}} ",
				"-- <enter>"
			],
			"shutdown_command": "echo '{{user `password`}}' | sudo -S shutdown -P -h now"
		},
		{
			"name": "virtualbox-web-wheezy-php55",
			"type": "virtualbox-iso",
			"guest_os_type": "Debian_64",
			"vm_name": "web-wheezy-php55",
			"iso_url": "http://cdimage.debian.org/mirror/cdimage/archive/7.8.0/amd64/iso-cd/debian-7.8.0-amd64-netinst.iso",
			"iso_checksum": "a91fba5001cf0fbccb44a7ae38c63b6e",
			"iso_checksum_type": "md5",
			"output_directory": "./builds/virtualbox-web-wheezy-php55/virtualbox",
			"ssh_username": "{{user `username`}}",
			"ssh_password": "{{user `password`}}",
			"ssh_wait_timeout": "30m",
			"http_directory": "./scripts",
			"boot_wait": "5s",
			"boot_command": [
				"<esc><wait>",
				"install auto=true ",
				"preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg ",
				"keymap=us ",
				"netcfg/get_domain=unassigned-domain ",
				"hostname={{ .Name }} ",
				"passwd/username={{user `username`}} ",
				"passwd/user-fullname={{user `username`}} ",
				"passwd/user-password-again={{user `password`}} ",
				"passwd/user-password={{user `password`}} ",
				"-- <enter>"
			],
			"shutdown_command": "echo '{{user `password`}}' | sudo -S shutdown -P -h now"
		},
		{
			"name": "virtualbox-web-jessie-php56",
			"type": "virtualbox-iso",
			"guest_os_type": "Debian_64",
			"vm_name": "web-jessie-php56",
			"iso_url": "http://cdimage.debian.org/mirror/cdimage/release/8.0.0/amd64/iso-cd/debian-8.0.0-amd64-netinst.iso",
			"iso_checksum": "d9209f355449fe13db3963571b1f52d4",
			"iso_checksum_type": "md5",
			"output_directory": "./builds/virtualbox-web-jessie-php56/virtualbox",
			"ssh_username": "{{user `username`}}",
			"ssh_password": "{{user `password`}}",
			"ssh_wait_timeout": "30m",
			"http_directory": "./scripts",
			"boot_wait": "5s",
			"boot_command": [
				"<esc><wait>",
				"install auto=true ",
				"preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg ",
				"keymap=us ",
				"netcfg/get_domain=unassigned-domain ",
				"hostname={{ .Name }} ",
				"passwd/username={{user `username`}} ",
				"passwd/user-fullname={{user `username`}} ",
				"passwd/user-password-again={{user `password`}} ",
				"passwd/user-password={{user `password`}} ",
				"-- <enter>"
			],
			"shutdown_command": "echo '{{user `password`}}' | sudo -S shutdown -P -h now"
		},
		{
			"name": "virtualbox-web-jessie-hhvm",
			"type": "virtualbox-iso",
			"guest_os_type": "Debian_64",
			"vm_name": "web-jessie-hhvm",
			"iso_url": "http://cdimage.debian.org/mirror/cdimage/release/8.0.0/amd64/iso-cd/debian-8.0.0-amd64-netinst.iso",
			"iso_checksum": "d9209f355449fe13db3963571b1f52d4",
			"iso_checksum_type": "md5",
			"output_directory": "./builds/virtualbox-web-jessie-hhvm/virtualbox",
			"ssh_username": "{{user `username`}}",
			"ssh_password": "{{user `password`}}",
			"ssh_wait_timeout": "30m",
			"http_directory": "./scripts",
			"boot_wait": "5s",
			"boot_command": [
				"<esc><wait>",
				"install auto=true ",
				"preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg ",
				"keymap=us ",
				"netcfg/get_domain=unassigned-domain ",
				"hostname={{ .Name }} ",
				"passwd/username={{user `username`}} ",
				"passwd/user-fullname={{user `username`}} ",
				"passwd/user-password-again={{user `password`}} ",
				"passwd/user-password={{user `password`}} ",
				"-- <enter>"
			],
			"shutdown_command": "echo '{{user `password`}}' | sudo -S shutdown -P -h now"
		}
	],
	"provisioners": [
		{
			"type": "file",
			"source": "./scripts/silverstripe/_ss_environment.php",
			"destination": "/var/tmp/_ss_environment.php"
		},
		{
			"type": "file",
			"source": "./scripts/silverstripe/GeneratePagesTask.php",
			"destination": "/var/tmp/GeneratePagesTask.php"
		},
		{
			"type": "file",
			"source": "./scripts/php/apc.php",
			"destination": "/var/tmp/apc.php"
		},
		{
			"type": "file",
			"source": "./scripts/php/opcache.php",
			"destination": "/var/tmp/opcache.php"
		},
		{
			"type": "file",
			"source": "./scripts/apache2/silverstripe-vhost",
			"destination": "/var/tmp/silverstripe-vhost",
			"only": [
				"virtualbox-web-squeeze-php53",
				"virtualbox-web-wheezy-php54",
				"virtualbox-web-wheezy-php55"
			]
		},
		{
			"type": "file",
			"source": "./scripts/apache24/silverstripe-vhost",
			"destination": "/var/tmp/silverstripe-vhost",
			"only": [
				"virtualbox-web-jessie-php56"
			]
		},
		{
			"type": "file",
			"source": "./scripts/nginx/silverstripe-vhost",
			"destination": "/var/tmp/silverstripe-vhost",
			"only": [
				"virtualbox-web-jessie-hhvm"
			]
		},
		{
			"type": "file",
			"source": "./scripts/nginx/hhvm.conf",
			"destination": "/var/tmp/nginx-hhvm.conf",
			"only": [
				"virtualbox-web-jessie-hhvm"
			]
		},
		{
			"type": "file",
			"source": "./scripts/nginx/silverstripe.conf",
			"destination": "/var/tmp/nginx-silverstripe.conf",
			"only": [
				"virtualbox-web-jessie-hhvm"
			]
		},
		{
			"type": "shell",
			"script": "./scripts/virtualbox-guestadditions.sh",
			"execute_command": "echo '{{user `password`}}' | {{.Vars}} sudo -E -S '{{.Path}}'"
		},
		{
			"type": "shell",
			"script": "./scripts/vagrant.sh",
			"execute_command": "echo '{{user `password`}}' | {{.Vars}} sudo -E -S '{{.Path}}'"
		},
		{
			"type": "shell",
			"script": "./scripts/debian-base.sh",
			"execute_command": "echo '{{user `password`}}' | {{.Vars}} sudo -E -S '{{.Path}}'"
		},
		{
			"type": "shell",
			"script": "./scripts/debian-squeeze-mariadb.sh",
			"execute_command": "echo '{{user `password`}}' | {{.Vars}} sudo -E -S '{{.Path}}'",
			"only": [
				"virtualbox-web-squeeze-php53"
			]
		},
		{
			"type": "shell",
			"script": "./scripts/debian-wheezy-mariadb.sh",
			"execute_command": "echo '{{user `password`}}' | {{.Vars}} sudo -E -S '{{.Path}}'",
			"only": [
				"virtualbox-web-wheezy-php54",
				"virtualbox-web-wheezy-php55"
			]
		},
		{
			"type": "shell",
			"script": "./scripts/debian-jessie-mariadb.sh",
			"execute_command": "echo '{{user `password`}}' | {{.Vars}} sudo -E -S '{{.Path}}'",
			"only": [
				"virtualbox-web-jessie-php56",
				"virtualbox-web-jessie-hhvm"
			]
		},
		{
			"type": "shell",
			"script": "./scripts/debian-squeeze-php53.sh",
			"execute_command": "echo '{{user `password`}}' | {{.Vars}} sudo -E -S '{{.Path}}'",
			"only": [
				"virtualbox-web-squeeze-php53"
			]
		},
		{
			"type": "shell",
			"script": "./scripts/debian-wheezy-php54.sh",
			"execute_command": "echo '{{user `password`}}' | {{.Vars}} sudo -E -S '{{.Path}}'",
			"only": [
				"virtualbox-web-wheezy-php54"
			]
		},
		{
			"type": "shell",
			"script": "./scripts/debian-wheezy-php55.sh",
			"execute_command": "echo '{{user `password`}}' | {{.Vars}} sudo -E -S '{{.Path}}'",
			"only": [
				"virtualbox-web-wheezy-php55"
			]
		},
		{
			"type": "shell",
			"script": "./scripts/debian-jessie-php56.sh",
			"execute_command": "echo '{{user `password`}}' | {{.Vars}} sudo -E -S '{{.Path}}'",
			"only": [
				"virtualbox-web-jessie-php56"
			]
		},
		{
			"type": "shell",
			"script": "./scripts/debian-jessie-hhvm.sh",
			"execute_command": "echo '{{user `password`}}' | {{.Vars}} sudo -E -S '{{.Path}}'",
			"only": [
				"virtualbox-web-jessie-hhvm"
			]
		},
		{
			"type": "shell",
			"script": "./scripts/silverstripe-php5-apache2.sh",
			"execute_command": "echo '{{user `password`}}' | {{.Vars}} sudo -E -S '{{.Path}}'",
			"only": [
				"virtualbox-web-squeeze-php53",
				"virtualbox-web-wheezy-php54",
				"virtualbox-web-wheezy-php55",
				"virtualbox-web-jessie-php56"
			]
		},
		{
			"type": "shell",
			"script": "./scripts/silverstripe-hhvm-nginx.sh",
			"execute_command": "echo '{{user `password`}}' | {{.Vars}} sudo -E -S '{{.Path}}'",
			"only": [
				"virtualbox-web-jessie-hhvm"
			]
		},
		{
			"type": "shell",
			"script": "./scripts/cleanup.sh",
			"execute_command": "echo '{{user `password`}}' | {{.Vars}} sudo -E -S '{{.Path}}'"
		}
	],
	"post-processors": [
		{
			"type": "vagrant",
			"output": "./builds/{{.BuildName}}/vagrant.box"
		}
	]
}
